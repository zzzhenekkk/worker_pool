# WorkerPool

WorkerPool — это простая и эффективная библиотека на Go для управления пулом воркеров с возможностью динамического добавления и удаления воркеров во время выполнения программы. Она предназначена для распределения обработки входных данных между несколькими воркерами, что повышает производительность и эффективность вашего приложения.

## Возможности

- **Динамическое добавление воркеров**: вы можете добавлять новых воркеров в пул в любое время.
- **Динамическое удаление воркеров**: вы можете удалять воркеров из пула по идентификатору или удалять первый активный воркер.
- **Обработка входных данных**: воркеры получают данные из канала и обрабатывают их (например, выводят на экран).
- **Безопасная остановка**: корректное завершение работы всех воркеров при остановке пула.
- **Потокобезопасность**: все методы библиотеки безопасны для использования в многопоточных приложениях.

## Установка

Вы можете установить библиотеку с помощью команды `go get`:

    go get github.com/zzzhenekkk/workerpool

## Использование

### Создание пула воркеров
```go

// Создаем новый пул воркеров с функцией по умолчанию для обработки строк
wp := workerpool.NewWorkerPool()

// Или передаем свою функцию обработки данных
customHandler := func(workerID int, data interface{}) {
    fmt.Printf("Воркер %d обработал данные: %v\n", workerID, data)
}
wp := workerpool.NewWorkerPool(customHandler)
```

### Добавление воркеров

    // Добавляем одного воркера
    wp.AddWorker()

    // Добавляем нескольких воркеров
    for i := 0; i < 5; i++ {
        wp.AddWorker()
    }

### Отправка данных на обработку

    // Получаем канал для ввода данных
    inputCh := wp.InputChannel()

    // Отправляем данные в канал
    inputCh <- "Данные для обработки"

### Динамическое удаление воркеров

    // Удаляем воркера по его идентификатору
    wp.RemoveWorker(2)

    // Удаляем первого активного воркера
    wp.RemoveWorkerFirstActive()

### Остановка пула воркеров

    // Корректно закрываем пул воркеров
    wp.CloseWP()

    // Ждем завершения всех воркеров
    wp.Wait()

### Пример полного использования
```go
    package main

import (
    "fmt"
    "time"

    "github.com/zzzhenekkk/workerpool"
)

func customDataHandler(workerID int, data interface{}) {
    fmt.Printf("Воркер %d обрабатывает данные: %v\n", workerID, data)
}

func main() {
    wp := workerpool.NewWorkerPool(customDataHandler)

    // Добавляем воркеров
    for i := 0; i < 3; i++ {
        wp.AddWorker()
    }

    // Отправляем данные на обработку
    inputCh := wp.InputChannel()
    for i := 0; i < 10; i++ {
        data := fmt.Sprintf("Сообщение %d", i)
        inputCh <- data
        time.Sleep(100 * time.Millisecond)
    }

    // Удаляем первого активного воркера
    wp.RemoveWorkerFirstActive()

    // Закрываем пул и ждем завершения работы всех воркеров
    wp.CloseWP()
    wp.Wait()

    fmt.Println("Обработка данных завершена")
}
```
## Описание API

### `NewWorkerPool(handlers ...DataProcessor) *WorkerPool`

Создает новый экземпляр WorkerPool. Принимает необязательный параметр — пользовательскую функцию обработки данных DataProcessor.

по умолчанию, если вы не задаете обработчик, стоит вот такой
```go
func defaultDataHandler(workerID int, data interface{}) {
	if str, ok := data.(string); ok {
		fmt.Printf("Вокрер %d обрабатывает данные: %s\n", workerID, str)
	} else {
		fmt.Printf("Вокрер %d, данные не являются строкой: %v\n", workerID, data)
	}
}
```

### `AddWorker()`
Добавляет нового воркера в пул.

### `RemoveWorker(id int)`
Удаляет воркера из пула по его идентификатору.

### `RemoveWorkerFirstActive()`
Удаляет первый активный воркер из пула.

### `InputChannel() chan<- string`
Возвращает канал для отправки данных на обработку воркерами.

### `CloseWP()`
Корректно завершает работу пула воркеров, останавливая всех активных воркеров.

### `Wait()`
Ожидает завершения работы всех воркеров.

### `CountActiveWorkers() int`
Возвращает количество активных воркеров в пуле.

## Примечания

- **Потокобезопасность**: все методы `WorkerPool` потокобезопасны и могут вызываться из разных горутин.
- **Закрытие канала ввода**: после отправки всех данных рекомендуется завершить работа пула воркера с помощью `CloseWP()`, канал InputChannel() автоматически закроется, дополнительно ничего делать не нужно! вокреры доделают те задачи, которые взяли в обработку!
- **Динамическое управление воркерами**: вы можете добавлять и удалять воркеры в зависимости от нагрузки и потребностей вашего приложения.
- **Обработка ошибок**: текущая реализация не обрабатывает возможные ошибки при отправке данных в закрытый канал. Убедитесь, что канал ввода не закрыт перед отправкой данных или обрабатывайте возможные паники.
- **Гонки данных**: библиотека использует мьютексы (`sync.Mutex`) для защиты общих ресурсов и предотвращения гонок данных.

## Тестирование

Для проверки корректности работы пула воркеров вы можете использовать предоставленные тесты или написать свои.

    go test -v

## Лицензия

Этот проект лицензируется под лицензией "Рога и копыта".

## Вклад

Если у вас есть предложения, улучшения или вы нашли ошибку, пожалуйста, создайте issue или отправьте pull request в репозитории проекта.

## Контактная информация

Автор: zzzhenekkk

GitHub: [https://github.com/zzzhenekkk/workerpool](https://github.com/zzzhenekkk/workerpool)
